<html>
<head>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="/javascripts/compiled/hose.js"></script>
    <script src="/javascripts/compiled/hydrant.js"></script>
    <script src="/javascripts/compiled/pump.js"></script>
    <script src="/javascripts/compiled/scenario.js"></script>
    <script src="/javascripts/compiled/valve.js"></script>
    <script type="text/javascript">
        var scenario = new App.Scenario();
        var pump = scenario.easy();
        console.log(scenario.answer_str);
        var matching_pumps = (pump == pump.discharge[0].pump);
        console.log("pumps match? " + matching_pumps);
        var interval = setInterval(function() {
//            newPump = new App.Pump($('#pressure').val(), pump.discharge, pump.intake, pump.tank, pump.max_pressure, $('#relief_valve').val());
//            if (scenario.checkAnswer(newPump)) {
//                alert('correct!');
//                clearInterval(interval);
//                return;
//            }

            $('#pressure').val(pump.pressure());
            $('#intake_pressure').val(pump.intake);
            $('#relief_valve').val(pump.relief_valve);
            $('#tank').val(pump.tank);
            $('#open_percentage').val(pump.discharge[0].open_percentage);
            $('#valve_pressure_out').val(pump.discharge[0].pressureOut());
            $('#distance').val(pump.discharge[0].hose.distance);
            $('#diameter').val(pump.discharge[0].hose.diameter);
            $('#elevation').val(pump.discharge[0].hose.elevation);
            $('#total_pressure_loss').val(pump.discharge[0].hose.total_pressure_loss());
            $('#gpm').val(pump.discharge[0].hose.gallons_per_minute());
            $('#nozzle_pressure').val(pump.discharge[0].hose.nozzle_pressure());
        }, 1000);

        var tank_to_pump = function() {
            var ttp = pump.tankToPump();
            $('#tank_to_pump_indicator').html(ttp ? 'Open' : 'Closed');
        }

        var tank_fill = function() {
            var tf = $('#tank_fill_indicator');
            tf.html(tf.html() == 'Open' ? 'Closed' : 'Open');
        }

        var drive_pump = function() {
            var dp = pump.driveToPump();
            $('#drive_pump_indicator').html(dp ? 'Pump' : 'Drive');
        }

        var valve_adjust = function(input) {
            $('#open_percentage').val($(input).val());
            pump.discharge[0].setOpenPercentage(parseInt($(input).val()));
        }
    </script>
</head>
<body>
    <p>
        <h2>Pump</h2>
        <p>
            Idle Speed
            <input id="pressure"/>
            <input type="range" id="idle_speed" min="0" max="100" onchange="valve_adjust(this)"/>
            <!--<input type="button" id="raise_idle" value="Raise"/>-->
            <!--<input type="button" id="lower_idle" value="Lower"/>-->
        </p>
        <p>
            Intake Pressure
            <input id="intake_pressure"/>
        </p>
        <p>
            Relief Valve
            <input id="relief_valve"/>
        </p>
        <p>Tank<input id="tank"/></p>
        <p>
            <input type="button" id="tank_to_pump" value="Tank to Pump" onclick="tank_to_pump()"/>
            <span id="tank_to_pump_indicator">Closed</span>
        </p>
        <p>
            <input type="button" id="tank_fill" value="Tank Fill" onclick="tank_fill()"/>
            <span id="tank_fill_indicator">Closed</span>
        </p>
        <p>
            <input type="button" id="drive_pump" value="Drive/Pump" onclick="drive_pump()"/>
            <span id="drive_pump_indicator">Drive</span>
        </p>
    </p>
    <p>
        <h2>Valve</h2>
        <input type="range" min="0" max="100" onchange="valve_adjust(this)"/>
        <p>Open %<input id="open_percentage"/></p>
        <p>Pressure Out<input id="valve_pressure_out"/></p>
    </p>
    <p>
        <h2>Hose</h2>
        <p>Length<input id="distance"/></p>
        <p>Diameter<input id="diameter"/></p>
        <p>Elevation<input id="elevation"/></p>
        <p>Nozzle Pressure<input id="nozzle_pressure"/></p>
        <p>GPM<input id="gpm"/></p>
        <p>Total Pressure Loss<input id="total_pressure_loss"/></p>
    </p>
    <script type="text/javascript">
//        $('#raise_idle').bind('click', function(){ pump.idle_percentage += 10; });
//        $('#lower_idle').bind('click', function(){ pump.idle_percentage -= 10; });
        $('#idle_speed').bind('change', function(){ pump.idle_percentage = $(this).val(); });
    </script>
</body>
</html>